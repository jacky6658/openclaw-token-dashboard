# ⚠️ 常見問題解決方案

> 遇到問題不用慌！這裡有完整的解決方案

---

## 🚨 問題 1：端口被佔用 (EADDRINUSE)

### 錯誤訊息
```
Error: listen EADDRINUSE: address already in use :::3737
```

### 原因
3737 端口已經被其他 Dashboard 實例佔用

### ✅ 解決方案

#### 方法一：雙擊故障排除工具 ⭐
```
雙擊「故障排除.command」
→ 選擇 "y" 清理舊進程
→ 完成！
```

#### 方法二：手動清理
```bash
# 查找佔用進程
lsof -i :3737

# 清理所有 Dashboard 進程
pkill -f "node.*server.js"

# 或者強制清理特定 PID
kill -9 <PID>
```

#### 方法三：重啟啟動器（已自動修復）
```
現在「啟動 Dashboard.command」會自動檢測並清理舊進程
直接雙擊即可！
```

---

## 🚨 問題 2：前端無法連接 (404 錯誤)

### 錯誤訊息
```
GET http://localhost:3737/api/config 404 (Not Found)
SyntaxError: Unexpected token '<'
```

### 原因
- 伺服器未啟動
- 或運行的是舊版本代碼

### ✅ 解決方案

```bash
# 1. 停止所有舊進程
pkill -f "node.*server.js"

# 2. 重新啟動
雙擊「啟動 Dashboard.command」

# 3. 強制刷新瀏覽器
Cmd + Shift + R (macOS)
Ctrl + Shift + R (Windows)
```

---

## 🚨 問題 3：啟動器無法執行

### 錯誤訊息
```
無法打開「啟動 Dashboard.command」，因為無法驗證開發者
```

### 原因
macOS 安全性設定

### ✅ 解決方案

#### 首次開啟
```
1. 右鍵點擊「啟動 Dashboard.command」
2. 選擇「打開」
3. 點擊「打開」確認
4. ✅ 之後就能直接雙擊使用
```

#### 或修改安全性設定
```
系統偏好設定 > 安全性與隱私 > 一般
→ 點擊「仍要打開」
```

---

## 🚨 問題 4：缺少依賴

### 錯誤訊息
```
Error: Cannot find module 'express'
Error: Cannot find module 'sqlite3'
```

### 原因
未安裝 Node.js 依賴

### ✅ 解決方案

```bash
cd /Users/user/clawd/projects/token-dashboard
npm install
```

或雙擊「故障排除.command」自動安裝

---

## 🚨 問題 5：Node.js 未安裝

### 錯誤訊息
```
command not found: node
```

### 原因
系統未安裝 Node.js

### ✅ 解決方案

```
1. 前往 https://nodejs.org/
2. 下載 LTS 版本（推薦）
3. 安裝
4. 重新啟動終端機
5. 驗證：node -v
```

---

## 🚨 問題 6：Gateway 未運行

### 錯誤訊息
```
警告：Gateway 未運行
```

### 原因
OpenClaw Gateway 服務未啟動

### ✅ 解決方案

```bash
# 啟動 Gateway
openclaw gateway start

# 檢查狀態（可能卡住，建議用下面的）
pgrep -f "openclaw.*gateway"

# 重啟 Gateway
openclaw gateway restart
```

**注意**：Dashboard 仍可使用，但模型切換功能需要 Gateway

---

## 🚨 問題 7：手機無法連接

### 錯誤訊息
```
無法連接到 http://192.168.x.x:3737
```

### 原因
- 不在同一個 WiFi
- 防火牆阻擋
- IP 位址錯誤

### ✅ 解決方案

#### 檢查 WiFi
```
✅ 電腦和手機連接同一個 WiFi
✅ 不是「同名」而是「同一個網路」
❌ 不支援公共 WiFi
```

#### 檢查防火牆
```
系統偏好設定 > 安全性與隱私 > 防火牆
→ 允許 Node.js 接收連線
```

#### 確認 IP 位址
```
雙擊「手機訪問指南.html」
→ 點擊「自動偵測 IP」
→ 使用顯示的 IP
```

#### 測試連接
```bash
# 在電腦上測試
curl http://localhost:3737/api/health

# 應顯示
{"status":"ok","timestamp":"..."}
```

---

## 🚨 問題 8：OpenClaw 未安裝

### 錯誤訊息
```
command not found: openclaw
```

### 原因
系統未安裝 OpenClaw

### ✅ 解決方案

Dashboard 仍可運行，但功能受限：

**可用功能：**
- ✅ 查看歷史數據
- ✅ 介面展示
- ✅ 統計圖表

**不可用功能：**
- ❌ 切換模型
- ❌ 即時配額監控
- ❌ Gateway 狀態

**安裝 OpenClaw：**
請參考您的 OpenClaw 安裝指南

---

## 🚨 問題 9：配置文件錯誤

### 錯誤訊息
```
SyntaxError: Unexpected token in JSON
```

### 原因
`~/.openclaw/openclaw.json` 格式錯誤

### ✅ 解決方案

```bash
# 檢查配置文件
cat ~/.openclaw/openclaw.json

# 驗證 JSON 格式
python -m json.tool ~/.openclaw/openclaw.json

# 如果損壞，備份後重新配置
mv ~/.openclaw/openclaw.json ~/.openclaw/openclaw.json.backup
openclaw configure
```

---

## 🚨 問題 10：瀏覽器不自動開啟

### 原因
`open` 命令失敗或被阻擋

### ✅ 解決方案

```
手動在瀏覽器中開啟：
http://localhost:3737
```

**建議加入書籤**以便快速訪問

---

## 🔧 萬能故障排除流程

```
1. 雙擊「故障排除.command」
   ↓
2. 根據診斷結果修復問題
   ↓
3. 重新啟動 Dashboard
   ↓
4. 瀏覽器強制刷新 (Cmd+Shift+R)
   ↓
5. ✅ 完成！
```

---

## 📞 還是無法解決？

### 收集診斷資訊

```bash
# 1. Node.js 版本
node -v
npm -v

# 2. OpenClaw 狀態
openclaw --version
pgrep -f "openclaw.*gateway"

# 3. 端口狀態
lsof -i :3737

# 4. 錯誤日誌
# 查看啟動器視窗的完整錯誤訊息
```

### 重置到乾淨狀態

```bash
cd /Users/user/clawd/projects/token-dashboard

# 清理所有進程
pkill -f "node.*server.js"

# 清理依賴
rm -rf node_modules

# 重新安裝
npm install

# 重新啟動
雙擊「啟動 Dashboard.command」
```

---

## 🎯 預防性建議

### 正確啟動方式
```
✅ 雙擊「啟動 Dashboard.command」
❌ 不要同時啟動多個實例
❌ 不要在多個終端機中運行
```

### 正確停止方式
```
✅ 關閉啟動器視窗
✅ 按 Ctrl+C 停止
✅ 執行: pkill -f "node.*server.js"
```

### 日常使用
```
1. 每次使用前檢查是否有舊進程
2. 只保持一個 Dashboard 實例運行
3. 遇到問題先雙擊「故障排除.command」
```

---

## 📋 快速命令參考

```bash
# 查看端口佔用
lsof -i :3737

# 清理 Dashboard 進程
pkill -f "node.*server.js"

# 安裝依賴
npm install

# 啟動 Gateway
openclaw gateway start

# 檢查 Gateway
pgrep -f "openclaw.*gateway"

# 測試 API
curl http://localhost:3737/api/health
```

---

**記住：遇到問題就雙擊「故障排除.command」！** 🔧✨
